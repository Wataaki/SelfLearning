# KMS (Key Management Service) と CloudHSM  
機密性の高いデータを運用するには暗号化の施策が必要。  
暗号化や複合化に必要な鍵の管理をするサービス。  

## KMS と CloudHSM
両者の大きな違いは信頼の基点がユーザー自身なのか AWS に委ねるのかの違い。  
- KMS  
  AWS が管理するマネージドサービス。  
- CloudHSM  
  VPC 内で専有のハードウェアを利用して管理するサービス。  
  初期コストも月次の固定費も必要。  
  よほど大規模なシステムや特定の規制・法令に準拠する目的以外では利用することはほぼない。  

## アーキテクチャ設計のポイント  
秒間 100 を超える暗号化リクエストがある、あるいは公開暗号化を使いたい場合は CloudHSM を利用し、  
それ以外は KMS を使うという形になる。

## KMS の機能  
KMS の主な機能は鍵管理機能とデータ暗号化機能。  
データ暗号化機能は以下の 3 つがある。  
- Encrypt  
  暗号化するための API。  
  4KB までの平文データに対応している。  
- Decrypt  
  復号化のための API。  
- GenerateDataKey  
  ユーザーがデータの暗号化に利用するためのカスタマーデータキーを生成する。  

## マスターキーとデータキー  
- データキー (CDK)  
  データを暗号化するための鍵。  
- マスターキー (CMK)  
  データキーを暗号化するための鍵。  

データを暗号化したデータキーをマスターキーで暗号化して保護する。  
この手法を **エンベロープ暗号化** と呼ばれる。  

## クライアントサイド暗号化ちサーバーサイド暗号化  
- クライアントサイド暗号化  
  ユーザー側の処理で暗号化する方式。  
  AWS が提供する SDK を利用して行う。  
- サーバーサイド暗号化  
  AWS のサービスが暗号化する。  
  クライアントサイド暗号化のサーボスは少なく、該当するのは S3 などの一部のサービスのみ。  
