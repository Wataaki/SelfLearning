# Amazon DymanoDB
マネージド NoSQL データベースサービス。  
拡張性に非常に優れた Key-Value 型のデータベース。  
以下のような場合に利用するとメリットを発揮する。  
- 高い信頼性と拡張性を必要とするシステム  
- スループットが増減するようなビーク帯のあるシステム  
- 大量のデータを蓄積して高速な検索が可能なシステム  
- 広告やゲームなどのユーザー行動履歴を管理するシステム  
- Web アプリケーションの永続的セッションデータベース  

## DynamoDB の特徴  
### 高可用性設計  
DynamoDB は単一障害点 を持たない構成となっているため、サービス面での障害対応やメンテナンス時の運用を考える必要がほとんどない。  
DynamoDB 内のデータは自動的に 3 つの AZ に保存される仕組みになっている。  

### スループットキャパシティ  
- ReadCapacityUnit(RCU)  
  読み取りのスループットキャパシティを指定する指標。  
  1RCU は最大 4KB の項目に対して 1 秒あたり 1 回の強力な生合成のある読み取り性能、  
  あるいは 1 秒あたり 2 回の結果的に整合性のある読み取り性能を担保することを表す。  
- WriteCapacityUnit(WCU)  
  書き込みのスループットキャパシティを指定する指標。  
  1WUC は、最大 1KB の項目に対して 1 秒あたり 1 回の書き込み性能を担保することを表す。  
#### スループットキャパシティの自動スケーリング  
負荷の状況に応じてスループットキャパシティを自動的に増減することができる。  

### データパーディショニング  
DynamoDB はデータをパーティションという単位で分散保存する。  
1 つのパーティションに対して保存できる容量やスループットキャパシティが決まっているため、  
データの増加や指定したスループットのサイズによって最適化された状態を保つようにパーティションを拡張する。  
この制御は DynamoDB 内部で自動的に行われるため、利用者が意識することはない。  

### プライマリーとインデックス  
プライマリキーはデータ項目を一意に特定するための属性で、「パーティションキー」単独のものと  
「パーティションキー + ソートキー」の組み合わせで構成されるもの (複合キーテーブル) の 2 種類がある。  
また、プライマリキーはインデックスとしても利用され、データ検索の高速化に役立つ。  
しかし、プライマリキーだけでは高速な検索要件を満たせない場合は **セカンダリインデックス** を作成する必要がある。  
セカンダリインデックスには 2 種類ある。  
- ローカルセカンダリインデックス (LSI)  
  プライマリキーはテーブルで指定したパーティションキーと同じで、別の属性をソートキーとして作成するインデックスのことを指す。  
  LSI は複合キーテーブルにのみ作成可能。  
- グローバルセカンダリインデックス (GSI)
  プライマリキーとは異なる属性を使って作成するインデックスのことを指す。  

セカンダリインデックスは便利だが、 Key-Value 型のデータベースの使い方の本質ではない。  
複数のセカンダリインデックスを作成する必要がある場合は RDB への変更などの検討をする必要がある。  

### 期限切れデータの自動メンテナンス (Time to Live)  
DynamoDB 内の各項目には有効期間を設定でき、有効期間をすぎたデータは自動的に削除される。  
データは即時削除されず、有効期間が切れてから最大 48 時間以内に削除される。  

### DynamoDB Stream  
DynamoDB に対して行われた直近 24 時間の追加・更新・削除の変更履歴を保持する機能。  

### 強い一貫性を持った参照 (Consistent Read)
このオプションを有効にすると、参照のリクエストがあった時点よりも前に書き込まれているデータが全て反映された状態のデータを元に参照結果を返すようになる。  

### DynamoDB Accelerator (DAX)  
DynamoDB の前段にキャッシュクラスタを構成する拡張サービス。
DAX を利用すると性能が格段に向上することはもちろんのこと、 DynamoDB に対して直接読み取り操作を実施する回数が減少するため RCU の確保を抑え、コスト削減にも大きく貢献する。  
