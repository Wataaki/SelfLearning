# VPC (Amazon Virtual Private Cloud)
AWS ネットワークの中心
利用者ごとにプライベートなネットワークをAWS内に作成する

### インターネットゲートウェイ (IGW)
インターネット側の出口
VPC とインターネットと繋ぐゲートウェイ
VPC に 1 つだけアタッチすることができる
可用性の観点で単一障害点 (SPOF) となるのではと懸念されることがあるが、冗長化か障害時に復旧が自動でなされる。
ルートテーブルで IGW をターゲットに指定すると、その通信は IGW を通してインターネットに向けられる。
多くの場合、デフォルトルート (0.0.0.0/0) と指定する。

### 仮装プライベートゲートウェイ (VGW)
オンプレミスの各拠点をつなげる
VPC が VPN や　DirectConnect と接続するためのゲートウェイ。
VPC に 1 つだけアタッチすることができる

### VPC内に入れれないサービス
S3, CloudWatch, DynamoDB など
一部サービスは VPC 内に入れれないため連携の方法を考える必要がある

## IP アドレス
自由に IP アドレスをアサインすることができる (CIDR ブロック)
CIDR ブロックは /16 ~ /28 の範囲で作成できる
ネットワーク空間は可能な限り大きなサイズ (/16) で作成する。

## サブネット
EC2 インスタンスなどを起動するための VPC 内部に作るアドレスレンジ
CIDR　ブロックに範囲に収まる小さな CIDR ブロックをアサインすることができる
個々のサブネットには 1 つの仮想のルータがあり、
このルータがルートテーブルとネットワーク ACL の設定を持っていて、サブネット内の EC2 インスタンスのデフォルトゲートウェイになっている。

### ルートテーブル
AWS のルーティング要素には、ルートテーブルと各種ゲートウェイがある。
これを用いて VPC 内部と外部への通信を実装する。
1 つのルートテーブルを不空数のサブネットに共有することはできるが、逆はできない。

### セキュリティグループとネットワーク ACL
VPC の通信制御は、セキュリティグループとネットワーク ACL(NACL) を利用して行う。

#### セキュリティグループ
EC2, ELB, RDS など、インスタンス単位の通信制御に利用する。
インバウンド (内向き) とアウトバウンド (外向き) の両方の制御が可能。
制御項目として、プロトコル, ポート範囲, 送受信先の CIDR かセキュリティグループを指定する。
状態を保持する。

#### ネットワーク ACL
サブネット毎の通信制御に利用する。
制御できる項目はセキュリティグループと同様。
セキュリティグループと違って、送受信先にセキュリティグループは指定できない。
状態を保持しない。

### ゲートウェイ
VPC の内部と外部との通信をやりとりする出入り口。
インターネットと接続するインターネットゲートウェイ (IGW)と
VPN や DirectConnect を経由してオンプレミスネットワーク基盤と接続する仮想プライベートゲートウェイ (VGW) がある。

### VPC エンドポイント
VPC ないから AWS サービスに接続する方法の一つ。
S3, DynamoDB と接続するゲートウェイエンドポイントと、
その他サービスに接続するインターフェイスエンドポイント (AWS PrivateLink) がある。

#### ゲートウェイエンドポイント
ルーティングを利用したサービス。
エンドポイントを作成し、サブネットと関連づけると、その通信は
インターネットゲートウェイではなく、エンドポイントを通じて行われる。

### ピアリング接続
2 つの VPC をプライベートな接続をするための機能。

### VPC フローログ
VPC 内の通信の解析には、VPC フローログ を利用します。
ENI (Elastic Network Interface) 単位で記録される。
