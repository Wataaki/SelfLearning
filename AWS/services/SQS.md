# SQS (Amazon Simple Queue Service)
AWS が提供するフルマネージドなメッセージキューイングサービス。  
AWS サービスの中で最古のもの。  

## SQS の機能
キューの管理とメッセージの管理の 2 つ。  
**キュー**とはメッセージを管理するための入れ物のようなもので、基本的には利用開始時に作成すれば管理する必要はなく、**エンドポイント**を介して利用する形になる。  

## StandardキューとFIFOキュー
- Standard キュー  
  取得のタイミングによって同一のメッセージが 2 回配信される可能性がある。  
  利用するシステム側でべき等性を保証する必要がある。  
  1 秒あたりのトラザクションは無制限。  
- FIFO キュー  
  Standard キューであった二重取得の問題は解消される。  
  が、Standard キューより秒あたりの処理件数は劣っている。  
  1 秒あたりのトラザクションはバッチ処理なしで 300 件、バッチ処理ありで 3000 件の制限がある。  

キューとしての使いやすさは　FIFO キューが優れている。  
FIFO のほうが料金が高い。  

## ロングポーリングとショートポーリング
キューのメッセージ取得方法として、ロングポーリングとショートポーリングがある。  
- ショートポーリング  
  デフォルト。リクエストを受けるとメッセージの有無にかかわらず即レスポンスを返す。  
  API の呼び出し回数も多くコストが高くなる。  
- ロングポーリング  
  メッセージがない場合は設定されたタイムアウトのギリギリまでレスポンスを返さない。  

複数のキューを単一スレッドで処理するような例外的なケース以外では、ロングポーリングを推奨。  

## 可視性タイムアウト
メッセージは受信しただけでは削除されず、クライアント側から明示的に削除指示を受けた時に削除される。  
同じメッセージの受信を防止する機能として可視性タイムアウトがある。  
可視性タイムアウトのデフォルト設定値は 30 秒で、最大 12 時間まで延長することができる。  

## 遅延キューとメッセージタイマー
メッセージの配信時間のコントロールとして、遅延キューとメッセージタイマーという 2 つの機能がある。  
- 遅延キュー  
  キューに送られたメッセージを一定時間見えなくする機能。  
- メッセージタイマー  
  個別のメッセージに対して一定時間見えなくする機能。  

## デッドレターキュー
処理できないメッセージを別のキューに移動する機能。  
指定された回数 (1~1000 回) 処理が失敗したメッセージを通常のキューから除外して、デッドレターキューに移動する。  
失敗したメッセージはキューに残り続けてしまうのでデッドレターキューを使って例外処理をする必要がある。  

## メッセージサイズ
キューに格納できるメッセージの最大サイズは 256 KB。  
画像情報などを扱うには S3 や DynamoDB に格納し、そこへのパスやキーといったポインター情報を受け渡すことで対応する。  
